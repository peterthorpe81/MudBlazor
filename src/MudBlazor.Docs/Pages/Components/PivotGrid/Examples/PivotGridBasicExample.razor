@using System.Net.Http.Json
@using MudBlazor.Examples.Data.Models
@using MudBlazor.Pivot
@namespace MudBlazor.Docs.Examples
@inject HttpClient httpClient

@if (ready)
{
    <MudPivotGrid T="Element" @ref="pivot" Items="@_elements" Columns=@Columns Rows="@Rows" Measures="@Measures" Options="@PivotTableRenderOption">   </MudPivotGrid>
}


@code {
    private IEnumerable<Element> _elements = new List<Element>();

    public List<PivotColumn<Element>> Columns { get; set; } = new List<PivotColumn<Element>>();
    public List<PivotColumn<Element>> Rows { get; set; } = new List<PivotColumn<Element>>();
    public List<PivotMeasure<Element>> Measures { get; set; } = new List<PivotMeasure<Element>>();
    public PivotTableRenderOption<Element> PivotTableRenderOption = new MudBlazor.PivotTableRenderOption<Element>();

    public MudPivotGrid<Element> pivot = null;
    public bool ready = false;
    protected override async Task OnInitializedAsync()
    {
        PivotTableRenderOption.Header[HeaderType.Row].RenderTotal = true;
        PivotTableRenderOption.Header[HeaderType.Column].RenderTotal = true;
        var columnOptions = new PivotAxisRenderOption() { TotalTitle = "Title Col", RenderTotal = true, TotalCssClass = "TotalCol" };
        var rowOptions = new PivotAxisRenderOption() { TotalTitle = "Total Row", RenderTotal = true, TotalCssClass = "TotalRow" };

        //PivotTableRenderOption.HeaderCellOption[pivot.ColumnByName(nameof(Element.Molar))].RenderTotal = true;
        //PivotTableRenderOption.HeaderCellOption[pivot.ColumnByName(nameof(Element.Molar))].TotalTitle = "test title";
        //PivotTableRenderOption.HeaderCellOption[pivot.ColumnByName(nameof(Element.Molar))].TotalCssClass = "test css";



        _elements = await httpClient.GetFromJsonAsync<List<Element>>("webapi/periodictable");

        Columns = PivotColumn<Element>.Build(columnOptions, nameof(Element.Position));
        Rows = PivotColumn<Element>.Build(rowOptions, nameof(Element.Group), nameof(Element.Name));
        Measures.Add(PivotMeasure<Element>.Sum(nameof(Element.Molar)));
        ready = true;
    }
}
