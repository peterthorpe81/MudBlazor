@using System.Net.Http.Json
@using MudBlazor.Examples.Data.Models
@using MudBlazor.Pivot
@namespace MudBlazor.Docs.Examples
@inject HttpClient httpClient

@if (ready)
{
    <MudPivotGrid T="PivotData" @ref="pivot" Items="@_PivotData" Columns=@Columns2 Rows="@Rows2" Measures="@Measures2"
        RowTotalPosition=OutputPosition.Below ColumnTotalPosition=OutputPosition.Below Color="Color.Secondary" Dense="true" Hover="true"
                  MeasureArrangement="MeasureArrangementType.Vertical">   </MudPivotGrid>


    <MudPivotGrid T="PivotData" @ref="pivot" Items="@_PivotData" Columns=@Columns Rows="@Rows" Measures="@Measures"
                  RowTotalPosition=OutputPosition.Below ColumnTotalPosition=OutputPosition.Below Color="Color.Secondary" Dense="true" Hover="true"
                  MeasureArrangement="MeasureArrangementType.Horizontal">   </MudPivotGrid>
}


@code {
    private IEnumerable<PivotData> _PivotData = new List<PivotData>();

    public List<PivotColumn<PivotData>> Columns { get; set; } = new List<PivotColumn<PivotData>>();
    public List<PivotColumn<PivotData>> Rows { get; set; } = new List<PivotColumn<PivotData>>();
    public List<PivotMeasure<PivotData>> Measures { get; set; } = new List<PivotMeasure<PivotData>>();

    public List<PivotColumn<PivotData>> Columns2 { get; set; } = new List<PivotColumn<PivotData>>();
    public List<PivotColumn<PivotData>> Rows2 { get; set; } = new List<PivotColumn<PivotData>>();
    public List<PivotMeasure<PivotData>> Measures2 { get; set; } = new List<PivotMeasure<PivotData>>();
    //public PivotTableRenderOption<PivotData> PivotTableRenderOption = new MudBlazor.PivotTableRenderOption<PivotData>();

    public MudPivotGrid<PivotData> pivot = null;
    public bool ready = false;
    protected override async Task OnInitializedAsync()
    {
        /*PivotTableRenderOption.Header[HeaderType.Row].RenderTotal = true;
        PivotTableRenderOption.Header[HeaderType.Column].RenderTotal = true;
        var columnOptions = new PivotAxisRenderOption() { TotalTitle = "Title Col", RenderTotal = true, TotalCssClass = "TotalCol" };
        var rowOptions = new PivotAxisRenderOption() { TotalTitle = "Total Row", RenderTotal = true, TotalCssClass = "TotalRow" };
        */
        //PivotTableRenderOption.HeaderCellOption[pivot.ColumnByName(nameof(PivotData.Molar))].RenderTotal = true;
        //PivotTableRenderOption.HeaderCellOption[pivot.ColumnByName(nameof(PivotData.Molar))].TotalTitle = "test title";
        //PivotTableRenderOption.HeaderCellOption[pivot.ColumnByName(nameof(PivotData.Molar))].TotalCssClass = "test css";


        await Task.Yield();
        _PivotData = new List<PivotData>()
        {
            new PivotData("A", "A1", "AX", "1", "1A", 20, 1),
            new PivotData("A", "A2", "AY", "1", "1A", 19, 2),
            new PivotData("A", "A2", "AY", "2", "2A", 18, 3),
            new PivotData("B", "B1", "AX", "1", "1B", 17, 4),
            new PivotData("B", "B2", "AY", "1", "1A", 16, 5),
            new PivotData("B", "B3", "AY", "2", "2A", 15, 6),
            new PivotData("C", "C1", "AX", "2", "2A", 14, 7),
            new PivotData("C", "C2", "AY", "1", "1A", 13, 8),
            new PivotData("C", "C3", "AY", "1", "1A", 12, 9)
        };



        Rows = PivotColumn<PivotData>.Build(nameof(PivotData.Category), nameof(PivotData.SubCategory), nameof(PivotData.SubCategory2));
        //Columns[0].Options
        Columns = PivotColumn<PivotData>.Build(nameof(PivotData.Type), nameof(PivotData.SubType));
        var measure = PivotMeasure<PivotData>.Sum(nameof(PivotData.Value));
        measure.Format = "0"; 
        var measure2 = PivotMeasure<PivotData>.Sum(nameof(PivotData.Value2));
        measure2.Format = "0.0";
        Measures.Add(measure);
        Measures.Add(measure2);


        Rows2 = PivotColumn<PivotData>.Build(nameof(PivotData.Category), nameof(PivotData.SubCategory), nameof(PivotData.SubCategory2));
        //Columns[0].Options
        Columns2 = PivotColumn<PivotData>.Build(nameof(PivotData.Type), nameof(PivotData.SubType));
        var measure3 = PivotMeasure<PivotData>.Sum(nameof(PivotData.Value));
        measure3.Format = "0";
        var measure4 = PivotMeasure<PivotData>.Sum(nameof(PivotData.Value2));
        measure4.Format = "0";
        Measures2.Add(measure3);
        Measures2.Add(measure4);


        ready = true;
    }

    public class PivotData
    {
        public PivotData(string category, string subCategory, string subCategory2, string type, string subType, int value, int value2)
        {
            Category = category;
            SubCategory = subCategory;
            SubCategory2 = subCategory2;
            Type = type;
            SubType = subType;
            Value = value;
            Value2 = value2;
        }

        public string Category { get; set; }
        public string SubCategory { get; set; }
        public string SubCategory2 { get; set; }
        public string Type { get; set; }
        public string SubType { get; set; }
        public int Value { get; set; }
        public int Value2 { get; set; }
    }
}
